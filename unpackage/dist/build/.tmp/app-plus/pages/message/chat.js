(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/chat"],{"09f3":function(e,t,s){"use strict";s.r(t);var i=s("43d5"),a=s("efcf");for(var n in a)"default"!==n&&function(e){s.d(t,e,function(){return a[e]})}(n);s("2862");var r=s("2877"),c=Object(r["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=c.exports},"12f4":function(e,t,s){"use strict";s.r(t);var i=s("1aa3"),a=s.n(i);for(var n in i)"default"!==n&&function(e){s.d(t,e,function(){return i[e]})}(n);t["default"]=a.a},"1aa3":function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={name:"graceIMMsg",props:{},data:function(){return{recShow:!1,recTxt:"请点击绿色按钮开始录音",inputMsg:"",recorderManager:null,recing:!1,tmpVoice:"",voiceLen:0}},created:function(){var t=this;this.recorderManager=e.getRecorderManager(),this.recorderManager.onStop(function(e){t.tmpVoice=e.tempFilePath}),this.recorderManager.onError(function(){e.showToast({title:"录音失败",icon:"none"}),t.recing=!1})},methods:{rec:function(){this.recing?(this.recorderManager.stop(),this.recing=!1):(this.recorderManager.start({duration:6e4,format:"mp3"}),this.recing=!0,this.recTxt="... 正在录音 ...")},sendVoiceMsg:function(){""!=this._self.tmpVoice?(this.$emit("sendVoiceMsg",this.tmpVoice),this.tmpVoice="",this.recShow=!1):e.showToast({title:"请先录制一段语音",icon:"none"})},showRec:function(){this.recShow=!0},closeRec:function(){this.recShow=!1},sendTextMsg:function(e){var t=e.detail.value;if(t.length<1)return!1;this.inputMsg="",this.$emit("sendTextMsg",t)},sendTextMsgByBtn:function(){var e=this.inputMsg;if(e.length<1)return!1;this.inputMsg="",this.$emit("sendTextMsg",e)},chooseImg:function(){var t=this;e.showLoading(),e.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){t.$emit("sendImgMsg",e.tempFilePaths[0])},complete:function(){e.hideLoading()}})}}};t.default=s}).call(this,s("649d")["default"])},2862:function(e,t,s){"use strict";var i=s("ddec"),a=s.n(i);a.a},"43d5":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("view",{staticClass:"grace-im"},[s("scroll-view",{style:{height:e.imHeight+"px"},attrs:{"scroll-y":"","scroll-top":e.scrollTop}},[s("view",{staticStyle:{height:"10px"}}),s("view",{staticClass:"grace-im-msg"},[s("view",{staticClass:"grace-im-system-msg",attrs:{eventid:"93343c3a-0"},on:{tap:e.getHistoryMsg}},[e._v(e._s(e.historyLodginText))])]),e._l(e.msgs,function(t,i){return s("block",{key:i},[1==t.ctype?s("view",{staticClass:"grace-im-msg",class:[e.userid==t.id?"grace-im-msg-right":"grace-im-msg-left"]},[s("view",{staticClass:"face"},[s("image",{attrs:{src:t.face,mode:"widthFix"}})]),s("view",[s("view",{staticClass:"grace-im-name"},[e.userid!=t.id?s("text",[e._v(e._s(t.name))]):e._e(),s("text",[e._v(e._s(t.date))])]),s("view",{staticClass:"grace-im-content-in"},[s("view",{staticClass:"content"},[e._v(e._s(t.msg))])])])]):e._e(),2==t.ctype?s("view",{staticClass:"grace-im-msg",class:[e.userid==t.id?"grace-im-msg-right":"grace-im-msg-left"]},[s("view",{staticClass:"face"},[s("image",{attrs:{src:t.face,mode:"widthFix"}})]),s("view",[s("view",{staticClass:"grace-im-name"},[e.userid!=t.id?s("block",[e._v(e._s(t.name))]):e._e(),s("text",[e._v(e._s(t.date))])],1),s("view",{staticClass:"grace-im-content-in"},[s("view",{staticClass:"imgs"},[s("image",{attrs:{src:t.msg,mode:"widthFix","data-index":i,eventid:"93343c3a-1-"+i},on:{tap:e.showImgs}})])])])]):e._e(),3==t.ctype?s("view",{staticClass:"grace-im-msg",class:[e.userid==t.id?"grace-im-msg-right":"grace-im-msg-left"]},[s("view",{staticClass:"face"},[s("image",{attrs:{src:t.face,mode:"widthFix"}})]),s("view",[s("view",{staticClass:"grace-im-name"},[e.userid!=t.id?s("block",[e._v(e._s(t.name))]):e._e(),s("text",[e._v(e._s(t.date))])],1),s("view",{staticClass:"grace-im-content-in"},[s("view",{staticClass:"content grace-im-voice-msg",class:i==e.playIndex?"grace-im-playing":"",staticStyle:{width:"300rpx"},attrs:{"data-voice":t.msg,"data-index":i,eventid:"93343c3a-2-"+i},on:{tap:e.playVoice}},[s("text",{staticClass:"graceIMFont icon-audio"})])])])]):e._e(),4==t.ctype?s("view",{staticClass:"grace-im-msg"},[s("view",{staticClass:"grace-im-system-msg"},[e._v(e._s(t.msg))])]):e._e()])}),s("view",{staticStyle:{height:"20px"}})],2)],1)},a=[];s.d(t,"a",function(){return i}),s.d(t,"b",function(){return a})},"4d6f":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("view",[s("graceIMMsg",{attrs:{msgs:e.msgs,userid:e.user.id,scrollTop:e.graceIMScTOP,historyLodginText:e.historyLodginText,eventid:"631f5603-0",mpcomid:"631f5603-0"},on:{getHistoryMsg:e.getHistoryMsg}}),s("graceIMFooter",{attrs:{eventid:"631f5603-1",mpcomid:"631f5603-1"},on:{sendTextMsg:e.sendTextMsg,sendImgMsg:e.sendImgMsg,sendVoiceMsg:e.sendVoiceMsg}})],1)},a=[];s.d(t,"a",function(){return i}),s.d(t,"b",function(){return a})},"4fe0":function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s("2f62"),a=r(s("9a57")),n=r(s("09f3"));function r(e){return e&&e.__esModule?e:{default:e}}var c,o=1,u={components:{graceIMFooter:a.default,graceIMMsg:n.default},data:function(){return{toId:0,msgs:[],graceIMScTOP:99999,historyLodginText:"点击加载历史消息"}},computed:(0,i.mapState)(["user"]),onLoad:function(t){c=this,c.toId=t.toId,e.onSocketMessage(function(e){c.receiveMsg(JSON.parse(e.data))})},onBackPress:function(){o=1},methods:{getHistoryMsg:function(){if("加载中"==this.historyLodginText||"已经加载全部历史消息"==this.historyLodginText)return!1;this.historyLodginText="加载中...",setTimeout(function(){if(o>1)return c.historyLodginText="已经加载全部历史消息",!1;for(var e=[{id:100,name:"历史",face:"https://staticimgs.oss-cn-beijing.aliyuncs.com/glogo.png",ctype:1,msg:"历史消息演示文本内容...",date:c.getNowDate()},{id:100,name:"历史",face:"https://staticimgs.oss-cn-beijing.aliyuncs.com/glogo.png",ctype:2,msg:"https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=645650495,1612690171&fm=170&s=7F1106C68E15024D189269B303007019&w=536&h=385&img.JPEG",date:c.getNowDate()}],t=0;t<e.length;t++)c.msgs.unshift(e[t]);c.historyLodginText="点击加载历史消息",o++},500)},receiveMsg:function(e){this.msgs.push(e),setTimeout(function(){c.graceIMScTOP=99e3+Math.random()},1e3)},sendMessage:function(t){this.receiveMsg(t),e.sendSocketMessage({data:JSON.stringify(t)}),e.request({url:this.GLOBAL.serverSrc+"common/top_chat/record",method:"POST",data:t})},sendTextMsg:function(e){var t=e,s={to_id:this.toId,id:this.user.id,name:this.user.userName,face:"https://staticimgs.oss-cn-beijing.aliyuncs.com/glogo.png",msg:t,ctype:1,date:this.getNowDate()};this.sendMessage(s)},sendImgMsg:function(t){var s=t,i={to_id:this.toId,id:this.user.id,name:this.user.userName,face:"https://staticimgs.oss-cn-beijing.aliyuncs.com/glogo.png",msg:"",ctype:2,date:this.getNowDate()};e.uploadFile({url:this.GLOBAL.serverSrc+"common/top_chat/recordimg",filePath:s,name:"file",success:function(e){var t=JSON.parse(e.data);200===t.status?(i.msg=t.imagePath,c.sendMessage(i)):console.log(JSON.stringify(e))},fail:function(e){c.GLOBAL.requestFail(e)}})},sendVoiceMsg:function(t){var s=this,i=t,a={to_id:this.toId,id:this.user.id,name:this.user.userName,face:"https://staticimgs.oss-cn-beijing.aliyuncs.com/glogo.png",msg:i,ctype:3,date:this.getNowDate()};console.log(JSON.stringify(t)),e.uploadFile({url:this.GLOBAL.serverSrc+"common/top_chat/recordvoice",filePath:i,name:"file",success:function(e){var t=JSON.parse(e.data);200===t.status?(a.msg=t.voicePath,c.sendMessage(a)):console.log(JSON.stringify(e))},fail:function(e){s.GLOBAL.requestFail(e)}})},getNowDate:function(){var e=new Date,t="-",s=":",i=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),r=e.getHours(),c=e.getMinutes(),o=e.getSeconds();a>=1&&a<=9&&(a="0"+a),n>=0&&n<=9&&(n="0"+n),r>=0&&r<=9&&(r="0"+r),c>=0&&c<=9&&(c="0"+c),o>=0&&o<=9&&(o="0"+o);var u=i+t+a+t+n+" "+r+s+c+s+o;return u}}};t.default=u}).call(this,s("649d")["default"])},"5a33":function(e,t,s){"use strict";s("859d");var i=n(s("b0ce")),a=n(s("d7f4"));function n(e){return e&&e.__esModule?e:{default:e}}Page((0,i.default)(a.default))},"93dd":function(e,t,s){},"9a57":function(e,t,s){"use strict";s.r(t);var i=s("a072"),a=s("12f4");for(var n in a)"default"!==n&&function(e){s.d(t,e,function(){return a[e]})}(n);s("9b8c");var r=s("2877"),c=Object(r["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=c.exports},"9b8c":function(e,t,s){"use strict";var i=s("a2a5"),a=s.n(i);a.a},a072:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("view",{staticClass:"grace-footer-wrap"},[s("view",{staticClass:"grace-im-footer"},[s("view",{staticClass:"grace-im-menus graceIMFonts icon-voice",style:{color:!0===e.recShow?"#00BA62;":""},attrs:{eventid:"63f6700e-0"},on:{tap:e.showRec}}),s("view",{staticClass:"grace-im-menus graceIMFonts icon-photograph",attrs:{eventid:"63f6700e-1"},on:{tap:e.chooseImg}}),s("view",{staticClass:"grace-im-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.inputMsg,expression:"inputMsg"}],attrs:{type:"text",fixed:"",eventid:"63f6700e-2"},domProps:{value:e.inputMsg},on:{confirm:e.sendTextMsg,input:function(t){t.target.composing||(e.inputMsg=t.target.value)}}})]),s("view",{staticClass:"grace-items",staticStyle:{padding:"0 8px","margin-right":"6px"},attrs:{eventid:"63f6700e-3"},on:{tap:e.sendTextMsgByBtn}},[e._v("发送")])]),e.recShow?s("view",{staticClass:"grace-im-record"},[s("view",{staticClass:"grace-im-record-txt"},[e._v(e._s(e.recTxt))]),s("view",{staticClass:"grace-im-record-btn",class:[e.recing?"grace-im-recording":""],attrs:{eventid:"63f6700e-4"},on:{tap:e.rec}}),""!=e.tmpVoice?s("view",{staticClass:"grace-im-record-txt",staticStyle:{"margin-top":"12px",color:"#00BA62"},attrs:{eventid:"63f6700e-5"},on:{tap:e.sendVoiceMsg}},[e._v("发送语音")]):e._e(),e.recing?e._e():s("view",{staticClass:"grace-im-record-close graceIMFonts icon-close",attrs:{eventid:"63f6700e-6"},on:{tap:e.closeRec}})]):e._e()])},a=[];s.d(t,"a",function(){return i}),s.d(t,"b",function(){return a})},a2a5:function(e,t,s){},c3e3:function(e,t,s){"use strict";s.r(t);var i=s("4fe0"),a=s.n(i);for(var n in i)"default"!==n&&function(e){s.d(t,e,function(){return i[e]})}(n);t["default"]=a.a},d7f4:function(e,t,s){"use strict";s.r(t);var i=s("4d6f"),a=s("c3e3");for(var n in a)"default"!==n&&function(e){s.d(t,e,function(){return a[e]})}(n);s("eed2");var r=s("2877"),c=Object(r["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=c.exports},ddec:function(e,t,s){},e252:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={name:"graceIMMsg",props:{msgs:{type:Array,default:function(){return[]}},userid:{type:Number,default:-1},scrollTop:{type:Number,default:99999},historyLodginText:{type:String,default:"点击加载历史消息"}},data:function(){return{player:null,playIndex:-1,imHeight:300}},created:function(){var t=this;this.player=e.getBackgroundAudioManager(),this.player.onPlay(function(){}),this.player.onEnded(function(){var e=t.playIndex;if(e<0)return!1;t.playIndex=-1;for(var s=e+1;s<t.msgs.length;s++)if(3==t.msgs[s].ctype){t.playNow(t.msgs[s].msg,s);break}}),e.getSystemInfo({success:function(e){t.imHeight=e.windowHeight-52;var s=plus.os.vendor;"Google"!=s&&(t.imHeight=e.windowHeight-105)}})},methods:{getHistoryMsg:function(){this.$emit("getHistoryMsg")},playVoice:function(e){var t=e.currentTarget.dataset.voice,s=e.currentTarget.dataset.index;if(-1==this.playIndex)return this.playNow(t,s);var i=this;this.playIndex==s?wx.getBackgroundAudioPlayerState({success:function(e){var t=e.status;switch(t){case 0:i.player.play();break;case 1:i.player.pause();break;default:i.player.play()}}}):(this.player.stop(),this.playNow(t,s))},playNow:function(e,t){return this.playIndex=t,this.player.src=e,this.player.title="graceUI",this.player.play(),!0},showImgs:function(e){for(var t=[],s="",i=e.currentTarget.dataset.index,a=0;a<this.msgs.length;a++)2==this.msgs[a].ctype&&(t.push(this.msgs[a].msg),i==a&&(s=this.msgs[a].msg));wx.previewImage({urls:t,current:s})}}};t.default=s}).call(this,s("649d")["default"])},eed2:function(e,t,s){"use strict";var i=s("93dd"),a=s.n(i);a.a},efcf:function(e,t,s){"use strict";s.r(t);var i=s("e252"),a=s.n(i);for(var n in i)"default"!==n&&function(e){s.d(t,e,function(){return i[e]})}(n);t["default"]=a.a}},[["5a33","common/runtime","common/vendor"]]]);