(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/market/goods/edit"],{"3b1f":function(t,e,a){"use strict";a.r(e);var i=a("5814"),s=a("bd2d");for(var n in s)"default"!==n&&function(t){a.d(e,t,function(){return s[t]})}(n);var c=a("2877"),r=Object(c["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"497c":function(t,e,a){"use strict";a("7f79");var i=n(a("b0ce")),s=n(a("3b1f"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},5814:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",[a("view",{staticClass:"grace-padding grace-bg-white"},[a("view",{staticClass:"grace-form"},[a("form",{attrs:{eventid:"5712dbfa-6"},on:{submit:t.formSubmit}},[a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("商品名")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"input",attrs:{type:"text",name:"title",placeholder:"请输入商品名称",eventid:"5712dbfa-0"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("商品价格")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],staticClass:"input",attrs:{type:"number",name:"price",placeholder:"请输入出售价格",eventid:"5712dbfa-1"},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}})]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("关键字")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.keywords,expression:"keywords"}],staticClass:"input",attrs:{type:"text",name:"keywords",placeholder:"多个关键字用英文逗号隔开",eventid:"5712dbfa-2"},domProps:{value:t.keywords},on:{input:function(e){e.target.composing||(t.keywords=e.target.value)}}})]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("成本价格")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.cost,expression:"cost"}],staticClass:"input",attrs:{type:"number",name:"cost",placeholder:"请输入成本价格",eventid:"5712dbfa-3"},domProps:{value:t.cost},on:{input:function(e){e.target.composing||(t.cost=e.target.value)}}})]),a("view",{staticClass:"grace-items",staticStyle:{height:"190rpx"}},[a("view",{staticClass:"grace-label"},[t._v("商品图片")]),a("view",{staticClass:"img"},[a("image",{staticStyle:{width:"210rpx",height:"180rpx","line-height":"180rpx"},attrs:{src:t.imgurl,eventid:"5712dbfa-4"},on:{click:t.uploadImg}})])]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("商品分类")]),a("view",{staticClass:"grace-form-r"},[a("picker",{attrs:{value:t.catesIndex,range:t.cates,name:"cate",eventid:"5712dbfa-5"},on:{change:t.bindPickerChange}},[a("text",[t._v(t._s(t.cates[t.catesIndex]))])])],1)]),a("view",{staticStyle:{padding:"22rpx 0","border-bottom":"1px solid #EBEBEB"}},[a("button",{staticStyle:{width:"100%",background:"#FF4500"},attrs:{loading:t.btnLoading,formType:"submit",type:"primary"}},[t._v("确定"+t._s(t.btnText))])],1)])],1)])])},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},bd2d:function(t,e,a){"use strict";a.r(e);var i=a("fd4f"),s=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);e["default"]=s.a},fd4f:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("2f62"),s=a("fdbe"),n={data:function(){return{isEdit:!1,title:"",price:"",cost:"",keywords:"",cateid:0,marketId:0,productId:0,catesIndex:0,cates:[],catesList:[],imgurl:"https://yuange666.oss-cn-beijing.aliyuncs.com/app/camera.png",btnText:"添加",btnLoading:!1}},computed:(0,i.mapState)(["user"]),onLoad:function(e){var a=this,i=this,s=t.getStorageSync("market");s.isMarket?(this.marketId=s.marketId,t.showLoading({title:"加载中..."}),t.request({url:this.GLOBAL.serverSrc+"market/management/productcate",method:"GET",data:{market_id:this.marketId},success:function(e){if(200===e.data.status)if(a.catesList=e.data.catesList,0===a.catesList.length)t.showModal({title:"提示",content:"您还未添加商品分类,点击确定去添加商品分类",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&t.navigateBack()}});else for(var i=0;i<a.catesList.length;i++)a.cates.push(a.catesList[i].title);else t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)},complete:function(){t.hideLoading()}}),"edit"===e.type&&(t.showLoading({title:"加载商品中..."}),this.isEdit=!0,this.btnText="修改",this.productId=e.product_id,t.request({url:i.GLOBAL.serverSrc+"market/management/product",method:"GET",data:{product_id:this.productId},success:function(e){if(200===e.data.status){var a=e.data.product;i.title=a.title,i.price=a.price,i.cost=a.cost,i.keywords=a.keywords,i.imgurl=a.img,i.cateid=a.cateid;for(var s=0;s<i.catesList.length;s++)i.catesList[s].cateid==i.cateid&&(i.catesIndex=s)}else t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){i.GLOBAL.requestFail(t)},complete:function(){t.hideLoading()}})),t.setNavigationBarTitle({title:"商品"+this.btnText})):t.showToast({title:"系统错误",icon:"none"})},methods:{bindPickerChange:function(t){this.catesIndex=t.detail.value},formSubmit:function(e){var a=this;if("https://yuange666.oss-cn-beijing.aliyuncs.com/app/camera.png"!==this.imgurl){var i=[{name:"title",checkType:"string",checkRule:"1,8",errorMsg:"商品名称应为1-8个字符"},{name:"price",checkType:"notnull",checkRule:"",errorMsg:"商品价格不能为空"},{name:"keywords",checkType:"string",checkRule:"1,30",errorMsg:"关键字不能为空"},{name:"cost",checkType:"notnull",checkRule:"",errorMsg:"成本价格不能为空"}],n=e.detail.value,c=s.check(n,i);if(c){var r="";this.isEdit?(n.product_id=this.productId,r=this.GLOBAL.serverSrc+"/market/management/productupdate"):r=this.GLOBAL.serverSrc+"/market/management/productadd",this.btnLoading=!0,n.phone=this.user.phone,n.token=this.user.token,n.market_id=this.marketId,n.img=this.imgurl,n.cateid=this.catesList[this.catesIndex].cateid,t.request({url:r,method:"POST",data:n,success:function(e){200===e.data.status?(t.showToast({title:"商品"+a.btnText+"成功"}),t.redirectTo({url:"./index?market_id="+a.marketId})):t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)},complete:function(){a.btnLoading=!1}})}else t.showToast({title:s.error,icon:"none"})}else t.showToast({title:"请上传商品图片",icon:"none"})},uploadImg:function(){var e=this,a=this;t.chooseImage({count:1,success:function(i){t.showLoading({title:"上传中..."});var s=i.tempFilePaths;t.uploadFile({url:e.GLOBAL.serverSrc+"market/product/upload",filePath:s[0],name:"file",success:function(e){var i=JSON.parse(e.data);200===i.status?a.imgurl=i.imagePath:t.showToast({title:i.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)},complete:function(){t.hideLoading()}})}})}}};e.default=n}).call(this,a("6e42")["default"])}},[["497c","common/runtime","common/vendor"]]]);