(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/market/goods/edit"],{"0204":function(t,e,a){"use strict";a("859d");var i=c(a("b0ce")),s=c(a("4011"));function c(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},"3f1b":function(t,e,a){"use strict";a.r(e);var i=a("ac83"),s=a.n(i);for(var c in i)"default"!==c&&function(t){a.d(e,t,function(){return i[t]})}(c);e["default"]=s.a},4011:function(t,e,a){"use strict";a.r(e);var i=a("eb67"),s=a("3f1b");for(var c in s)"default"!==c&&function(t){a.d(e,t,function(){return s[t]})}(c);var n=a("2877"),r=Object(n["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},ac83:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("2f62"),s=a("4e77"),c={data:function(){return{isEdit:!1,title:"",price:"",cost:"",keywords:"",cateid:0,marketId:0,productId:0,catesIndex:0,cates:[],catesList:[],imgurl:"https://yuange666.oss-cn-beijing.aliyuncs.com/app/camera.png",btnText:"添加",btnLoading:!1}},computed:(0,i.mapState)(["user"]),onLoad:function(e){var a=this,i=this,s=t.getStorageSync("market");s.isMarket?(this.marketId=s.marketId,t.showLoading({title:"加载中..."}),t.request({url:this.GLOBAL.serverSrc+"market/management/productcate",method:"GET",data:{market_id:this.marketId},success:function(e){if(200===e.data.status)if(a.catesList=e.data.catesList,0===a.catesList.length)t.showModal({title:"提示",content:"您还未添加商品分类,点击确定去添加商品分类",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&t.navigateBack()}});else for(var i=0;i<a.catesList.length;i++)a.cates.push(a.catesList[i].title);else t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)},complete:function(){t.hideLoading()}}),"edit"===e.type&&(t.showLoading({title:"加载商品中..."}),this.isEdit=!0,this.btnText="修改",this.productId=e.product_id,t.request({url:i.GLOBAL.serverSrc+"market/management/product",method:"GET",data:{product_id:this.productId},success:function(e){if(200===e.data.status){var a=e.data.product;i.title=a.title,i.price=a.price,i.cost=a.cost,i.keywords=a.keywords,i.imgurl=a.img,i.cateid=a.cateid;for(var s=0;s<i.catesList.length;s++)i.catesList[s].cateid==i.cateid&&(i.catesIndex=s)}else t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){i.GLOBAL.requestFail(t)},complete:function(){t.hideLoading()}})),t.setNavigationBarTitle({title:"商品"+this.btnText})):t.showToast({title:"系统错误",icon:"none"})},methods:{bindPickerChange:function(t){this.catesIndex=t.detail.value},formSubmit:function(e){var a=this;if("https://yuange666.oss-cn-beijing.aliyuncs.com/app/camera.png"!==this.imgurl){var i=[{name:"title",checkType:"string",checkRule:"1,8",errorMsg:"商品名称应为1-8个字符"},{name:"price",checkType:"notnull",checkRule:"",errorMsg:"商品价格不能为空"},{name:"keywords",checkType:"string",checkRule:"1,30",errorMsg:"关键字不能为空"},{name:"cost",checkType:"notnull",checkRule:"",errorMsg:"成本价格不能为空"}],c=e.detail.value,n=s.check(c,i);if(n){var r="";this.isEdit?(c.product_id=this.productId,r=this.GLOBAL.serverSrc+"/market/management/productupdate"):r=this.GLOBAL.serverSrc+"/market/management/productadd",this.btnLoading=!0,c.phone=this.user.phone,c.token=this.user.token,c.market_id=this.marketId,c.img=this.imgurl,c.cateid=this.catesList[this.catesIndex].cateid,t.request({url:r,method:"POST",data:c,success:function(e){200===e.data.status?(t.showToast({title:"商品"+a.btnText+"成功"}),t.redirectTo({url:"./index?market_id="+a.marketId})):t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)},complete:function(){a.btnLoading=!1}})}else t.showToast({title:s.error,icon:"none"})}else t.showToast({title:"请上传商品图片",icon:"none"})},uploadImg:function(){var e=this,a=this;t.chooseImage({count:1,success:function(i){t.showLoading({title:"上传中..."});var s=i.tempFilePaths;t.uploadFile({url:e.GLOBAL.serverSrc+"market/product/upload",filePath:s[0],name:"file",success:function(e){var i=JSON.parse(e.data);200===i.status?a.imgurl=i.imagePath:t.showToast({title:i.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)},complete:function(){t.hideLoading()}})}})}}};e.default=c}).call(this,a("6e42")["default"])},eb67:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",[a("view",{staticClass:"grace-padding grace-bg-white"},[a("view",{staticClass:"grace-form"},[a("form",{attrs:{eventid:"b0340454-2"},on:{submit:t.formSubmit}},[a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("商品名")]),a("input",{staticClass:"input",attrs:{type:"text",name:"title",value:t.title,placeholder:"请输入商品名称"}})]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("商品价格")]),a("input",{staticClass:"input",attrs:{type:"number",name:"price",value:t.price,placeholder:"请输入出售价格"}})]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("关键字")]),a("input",{staticClass:"input",attrs:{type:"text",name:"keywords",value:t.keywords,placeholder:"多个关键字用英文逗号隔开"}})]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("成本价格")]),a("input",{staticClass:"input",attrs:{type:"number",name:"cost",value:t.cost,placeholder:"请输入成本价格"}})]),a("view",{staticClass:"grace-items",staticStyle:{height:"190rpx"}},[a("view",{staticClass:"grace-label"},[t._v("商品图片")]),a("view",{staticClass:"img"},[a("image",{staticStyle:{width:"210rpx",height:"180rpx","line-height":"180rpx"},attrs:{src:t.imgurl,eventid:"b0340454-0"},on:{click:t.uploadImg}})])]),a("view",{staticClass:"grace-items"},[a("view",{staticClass:"grace-label"},[t._v("商品分类")]),a("view",{staticClass:"grace-form-r"},[a("picker",{attrs:{value:t.catesIndex,range:t.cates,name:"cate",eventid:"b0340454-1"},on:{change:t.bindPickerChange}},[a("text",[t._v(t._s(t.cates[t.catesIndex]))])])],1)]),a("view",{staticStyle:{padding:"22rpx 0","border-bottom":"1px solid #EBEBEB"}},[a("button",{staticStyle:{width:"100%",background:"#fb6566"},attrs:{loading:t.btnLoading,formType:"submit",type:"primary"}},[t._v("确定"+t._s(t.btnText))])],1)])],1)])])},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})}},[["0204","common/runtime","common/vendor"]]]);