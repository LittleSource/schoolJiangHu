(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/checkSchool"],{"0998":function(e,t,o){"use strict";o.r(t);var n=o("986a"),i=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,function(){return n[e]})}(a);t["default"]=i.a},"1d8d":function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}var l={KEY_ERR:311,KEY_ERR_MSG:"key格式错误",PARAM_ERR:310,PARAM_ERR_MSG:"请求参数信息有误",SYSTEM_ERR:600,SYSTEM_ERR_MSG:"系统错误",WX_ERR_CODE:1e3,WX_OK_CODE:200},s="https://apis.map.qq.com/ws/",r=s+"place/v1/search",c=s+"place/v1/suggestion",u=s+"geocoder/v1/",d=s+"district/v1/list",f=s+"district/v1/getchildren",g=s+"distance/v1/",p=6378136.49,_={location2query:function(e){if("string"==typeof e)return e;for(var t="",o=0;o<e.length;o++){var n=e[o];t&&(t+=";"),n.location&&(t=t+n.location.lat+","+n.location.lng),n.latitude&&n.longitude&&(t=t+n.latitude+","+n.longitude)}return t},rad:function(e){return e*Math.PI/180},getEndLocation:function(e){for(var t=e.split(";"),o=[],n=0;n<t.length;n++)o.push({lat:parseFloat(t[n].split(",")[0]),lng:parseFloat(t[n].split(",")[1])});return o},getDistance:function(e,t,o,n){var i=this.rad(e),a=this.rad(o),l=i-a,s=this.rad(t)-this.rad(n),r=2*Math.asin(Math.sqrt(Math.pow(Math.sin(l/2),2)+Math.cos(i)*Math.cos(a)*Math.pow(Math.sin(s/2),2)));return r*=p,r=Math.round(1e4*r)/1e4,parseFloat(r.toFixed(0))},getWXLocation:function(e,t,o){wx.getLocation({type:"gcj02",success:e,fail:t,complete:o})},getLocationParam:function(e){if("string"==typeof e){var t=e.split(",");e=2===t.length?{latitude:e.split(",")[0],longitude:e.split(",")[1]}:{}}return e},polyfillParam:function(e){e.success=e.success||function(){},e.fail=e.fail||function(){},e.complete=e.complete||function(){}},checkParamKeyEmpty:function(e,t){if(!e[t]){var o=this.buildErrorConfig(l.PARAM_ERR,l.PARAM_ERR_MSG+t+"参数格式有误");return e.fail(o),e.complete(o),!0}return!1},checkKeyword:function(e){return!this.checkParamKeyEmpty(e,"keyword")},checkLocation:function(e){var t=this.getLocationParam(e.location);if(!t||!t.latitude||!t.longitude){var o=this.buildErrorConfig(l.PARAM_ERR,l.PARAM_ERR_MSG+" location参数格式有误");return e.fail(o),e.complete(o),!1}return!0},buildErrorConfig:function(e,t){return{status:e,message:t}},handleData:function(e,t,o){if("search"===o){for(var n=t.data,i=[],a=0;a<n.length;a++)i.push({id:n[a].id||null,title:n[a].title||null,latitude:n[a].location&&n[a].location.lat||null,longitude:n[a].location&&n[a].location.lng||null,address:n[a].address||null,category:n[a].category||null,tel:n[a].tel||null,adcode:n[a].ad_info&&n[a].ad_info.adcode||null,city:n[a].ad_info&&n[a].ad_info.city||null,district:n[a].ad_info&&n[a].ad_info.district||null,province:n[a].ad_info&&n[a].ad_info.province||null});e.success(t,{searchResult:n,searchSimplify:i})}else if("suggest"===o){var l=t.data,s=[];for(a=0;a<l.length;a++)s.push({adcode:l[a].adcode||null,address:l[a].address||null,category:l[a].category||null,city:l[a].city||null,district:l[a].district||null,id:l[a].id||null,latitude:l[a].location&&l[a].location.lat||null,longitude:l[a].location&&l[a].location.lng||null,province:l[a].province||null,title:l[a].title||null,type:l[a].type||null});e.success(t,{suggestResult:l,suggestSimplify:s})}else if("reverseGeocoder"===o){var r=t.result,c={address:r.address||null,latitude:r.location&&r.location.lat||null,longitude:r.location&&r.location.lng||null,adcode:r.ad_info&&r.ad_info.adcode||null,city:r.address_component&&r.address_component.city||null,district:r.address_component&&r.address_component.district||null,nation:r.address_component&&r.address_component.nation||null,province:r.address_component&&r.address_component.province||null,street:r.address_component&&r.address_component.street||null,street_number:r.address_component&&r.address_component.street_number||null,recommend:r.formatted_addresses&&r.formatted_addresses.recommend||null,rough:r.formatted_addresses&&r.formatted_addresses.rough||null};if(r.pois){var u=r.pois,d=[];for(a=0;a<u.length;a++)d.push({id:u[a].id||null,title:u[a].title||null,latitude:u[a].location&&u[a].location.lat||null,longitude:u[a].location&&u[a].location.lng||null,address:u[a].address||null,category:u[a].category||null,adcode:u[a].ad_info&&u[a].ad_info.adcode||null,city:u[a].ad_info&&u[a].ad_info.city||null,district:u[a].ad_info&&u[a].ad_info.district||null,province:u[a].ad_info&&u[a].ad_info.province||null});e.success(t,{reverseGeocoderResult:r,reverseGeocoderSimplify:c,pois:u,poisSimplify:d})}else e.success(t,{reverseGeocoderResult:r,reverseGeocoderSimplify:c})}else if("geocoder"===o){var f=t.result,g={title:f.title||null,latitude:f.location&&f.location.lat||null,longitude:f.location&&f.location.lng||null,adcode:f.ad_info&&f.ad_info.adcode||null,province:f.address_components&&f.address_components.province||null,city:f.address_components&&f.address_components.city||null,district:f.address_components&&f.address_components.district||null,street:f.address_components&&f.address_components.street||null,street_number:f.address_components&&f.address_components.street_number||null,level:f.level||null};e.success(t,{geocoderResult:f,geocoderSimplify:g})}else if("getCityList"===o){var p=t.result[0],_=t.result[1],y=t.result[2];e.success(t,{provinceResult:p,cityResult:_,districtResult:y})}else if("getDistrictByCityId"===o){var m=t.result[0];e.success(t,m)}else if("calculateDistance"===o){var h=t.result.elements,v=[];for(a=0;a<h.length;a++)v.push(h[a].distance);e.success(t,{calculateDistanceResult:h,distance:v})}else e.success(t)},buildWxRequestConfig:function(e,t,o){var n=this;return t.header={"content-type":"application/json"},t.method="GET",t.success=function(t){var i=t.data;0===i.status?n.handleData(e,i,o):e.fail(i)},t.fail=function(t){t.statusCode=l.WX_ERR_CODE,e.fail(n.buildErrorConfig(l.WX_ERR_CODE,t.errMsg))},t.complete=function(t){var o=+t.statusCode;switch(o){case l.WX_ERR_CODE:e.complete(n.buildErrorConfig(l.WX_ERR_CODE,t.errMsg));break;case l.WX_OK_CODE:var i=t.data;0===i.status?e.complete(i):e.complete(n.buildErrorConfig(i.status,i.message));break;default:e.complete(n.buildErrorConfig(l.SYSTEM_ERR,l.SYSTEM_ERR_MSG))}},t},locationProcess:function(e,t,o,n){var i=this;if(o=o||function(t){t.statusCode=l.WX_ERR_CODE,e.fail(i.buildErrorConfig(l.WX_ERR_CODE,t.errMsg))},n=n||function(t){t.statusCode==l.WX_ERR_CODE&&e.complete(i.buildErrorConfig(l.WX_ERR_CODE,t.errMsg))},e.location){if(i.checkLocation(e)){var a=_.getLocationParam(e.location);t(a)}}else i.getWXLocation(t,o,n)}},y=function(){function e(t){if(n(this,e),!t.key)throw Error("key值不能为空");this.key=t.key}return a(e,[{key:"search",value:function(e){var t=this;if(e=e||{},_.polyfillParam(e),_.checkKeyword(e)){var o={keyword:e.keyword,orderby:e.orderby||"_distance",page_size:e.page_size||10,page_index:e.page_index||1,output:"json",key:t.key};e.address_format&&(o.address_format=e.address_format),e.filter&&(o.filter=e.filter);var n=e.distance||"1000",i=e.auto_extend||1,a=null,l=null;e.region&&(a=e.region),e.rectangle&&(l=e.rectangle);var s=function(t){o.boundary=a&&!l?"region("+a+","+i+","+t.latitude+","+t.longitude+")":l&&!a?"rectangle("+l+")":"nearby("+t.latitude+","+t.longitude+","+n+","+i+")",wx.request(_.buildWxRequestConfig(e,{url:r,data:o},"search"))};_.locationProcess(e,s)}}},{key:"getSuggestion",value:function(e){var t=this;if(e=e||{},_.polyfillParam(e),_.checkKeyword(e)){var o={keyword:e.keyword,region:e.region||"全国",region_fix:e.region_fix||0,policy:e.policy||0,page_size:e.page_size||10,page_index:e.page_index||1,get_subpois:e.get_subpois||0,output:"json",key:t.key};if(e.address_format&&(o.address_format=e.address_format),e.filter&&(o.filter=e.filter),e.location){var n=function(t){o.location=t.latitude+","+t.longitude,wx.request(_.buildWxRequestConfig(e,{url:c,data:o},"suggest"))};_.locationProcess(e,n)}else wx.request(_.buildWxRequestConfig(e,{url:c,data:o},"suggest"))}}},{key:"reverseGeocoder",value:function(e){var t=this;e=e||{},_.polyfillParam(e);var o={coord_type:e.coord_type||5,get_poi:e.get_poi||0,output:"json",key:t.key};e.poi_options&&(o.poi_options=e.poi_options);var n=function(t){o.location=t.latitude+","+t.longitude,wx.request(_.buildWxRequestConfig(e,{url:u,data:o},"reverseGeocoder"))};_.locationProcess(e,n)}},{key:"geocoder",value:function(e){var t=this;if(e=e||{},_.polyfillParam(e),!_.checkParamKeyEmpty(e,"address")){var o={address:e.address,output:"json",key:t.key};e.region&&(o.region=e.region),wx.request(_.buildWxRequestConfig(e,{url:u,data:o},"geocoder"))}}},{key:"getCityList",value:function(e){var t=this;e=e||{},_.polyfillParam(e);var o={output:"json",key:t.key};wx.request(_.buildWxRequestConfig(e,{url:d,data:o},"getCityList"))}},{key:"getDistrictByCityId",value:function(e){var t=this;if(e=e||{},_.polyfillParam(e),!_.checkParamKeyEmpty(e,"id")){var o={id:e.id||"",output:"json",key:t.key};wx.request(_.buildWxRequestConfig(e,{url:f,data:o},"getDistrictByCityId"))}}},{key:"calculateDistance",value:function(e){var t=this;if(e=e||{},_.polyfillParam(e),!_.checkParamKeyEmpty(e,"to")){var o={mode:e.mode||"walking",to:_.location2query(e.to),output:"json",key:t.key};if(e.from&&(e.location=e.from),"straight"==o.mode){var n=function(t){for(var n=_.getEndLocation(o.to),i={message:"query ok",result:{elements:[]},status:0},a=0;a<n.length;a++)i.result.elements.push({distance:_.getDistance(t.latitude,t.longitude,n[a].lat,n[a].lng),duration:0,from:{lat:t.latitude,lng:t.longitude},to:{lat:n[a].lat,lng:n[a].lng}});var l=i.result.elements,s=[];for(a=0;a<l.length;a++)s.push(l[a].distance);return e.success(i,{calculateResult:l,distanceResult:s})};_.locationProcess(e,n)}else{n=function(t){o.from=t.latitude+","+t.longitude,wx.request(_.buildWxRequestConfig(e,{url:g,data:o},"calculateDistance"))};_.locationProcess(e,n)}}}}]),e}();e.exports=y},"45fc":function(e,t,o){"use strict";o("859d");var n=a(o("b0ce")),i=a(o("5303"));function a(e){return e&&e.__esModule?e:{default:e}}Page((0,n.default)(i.default))},5303:function(e,t,o){"use strict";o.r(t);var n=o("6ae3"),i=o("0998");for(var a in i)"default"!==a&&function(e){o.d(t,e,function(){return i[e]})}(a);var l=o("2877"),s=Object(l["a"])(i["default"],n["a"],n["b"],!1,null,null,null);t["default"]=s.exports},"6ae3":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",[0===e.schoolList.length?o("view",{staticClass:"grace-center",staticStyle:{"font-size":"32rpx",color:"#2F2F2F"}},[e._v("当前学校:"+e._s(e.nowSchool.title))]):e._e(),e.schoolList.length>0?o("view",{staticClass:"grace-list"},e._l(e.schoolList,function(t,n){return o("view",{key:n,staticClass:"items",attrs:{eventid:"691dc3db-0-"+n},on:{click:function(t){e.setSchool(e.schoolList[n])}}},[o("view",{staticClass:"title"},[e._v(e._s(t.title))]),o("view",{staticClass:"arrow-right"})])})):e._e()])},i=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i})},"986a":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(o("1d8d"));function i(e){return e&&e.__esModule?e:{default:e}}var a=new n.default({key:"7YDBZ-4ATCD-5GM4Z-HCI5B-4ECM6-PPBXO"}),l={data:function(){return{schoolList:[],nowSchool:{}}},onLoad:function(){this.nowSchool=e.getStorageSync("school")},onNavigationBarSearchInputChanged:function(e){if(""!==e.text){var t=this;a.getSuggestion({keyword:e.text,filter:"category=大学,中学",success:function(e){for(var o=[],n=0;n<e.data.length;n++)o.push({id:e.data[n].id,title:e.data[n].title,addr:e.data[n].address});t.schoolList=o},fail:function(e){console.error(JSON.stringify(e))}})}else this.schoolList=[]},methods:{setSchool:function(t){e.showModal({title:"提示",content:"确定切换到 "+t.title+" 吗？\n学校位置:"+t.addr,success:function(o){o.confirm&&e.setStorage({key:"school",data:t,fail:function(){e.showModal({title:"提示",content:"学校切换失败！",showCancel:!1})},complete:function(){e.switchTab({url:"/pages/index/index"})}})}})}}};t.default=l}).call(this,o("649d")["default"])}},[["45fc","common/runtime","common/vendor"]]]);