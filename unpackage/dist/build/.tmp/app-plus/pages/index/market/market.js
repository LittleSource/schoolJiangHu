(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/market/market"],{"0556":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("2f62"),n=c(a("9f9e")),r=c(a("a2c9")),s=c(a("d946"));function c(t){return t&&t.__esModule?t:{default:t}}var o=null,u=100,l={components:{graceNumberBox:r.default,popupLayer:n.default,graceSpeaker:s.default},data:function(){return{popmenuShowX:!0,notices:[],currentCateIndex:1,leftTo:"cate1",productListTo:"productList1",mainCate:[],allProducts:{},marketId:0,goodsCount:0,shoppingCart:[]}},computed:(0,i.mapState)(["user"]),onLoad:function(e){var a=this;t.getSystemInfo({success:function(t){u=t.windowHeight}}),t.setNavigationBarTitle({title:e.market_name}),this.notices=JSON.parse(e.notices),this.marketId=e.market_id,t.request({url:this.GLOBAL.serverSrc+"market/product/select",method:"GET",data:{token:this.user.token,market_id:this.marketId},success:function(e){200===e.data.status?(a.allProducts=e.data.allProduct,a.mainCate=e.data.mainCate):t.showToast({title:e.data.msg,icon:"none"})},fail:function(t){a.GLOBAL.requestFail(t)}})},methods:{showImg:function(e){var a=[e];t.previewImage({urls:a})},changCate:function(t){var e=t.currentTarget.dataset.cateid;this.currentCateIndex=e,this.leftTo="cate"+e,this.productListTo="productList"+e},rscroll:function(t){var e=t.detail.scrollTop;null!=o&&clearTimeout(o),o=setTimeout(function(){this.getIndex(0,e)}.bind(this),80)},getIndex:function(t,e){var a=this,i=wx.createSelectorQuery();i.select("#productList"+this.mainCate[t].cateid).boundingClientRect(),i.selectViewport().scrollOffset(),i.exec(function(i){i[0].top+u/2>0?(a.currentCateIndex=a.mainCate[t].cateid,a.leftTo="cate"+a.mainCate[t].cateid):(t++,t<a.mainCate.length&&a.getIndex(t,e))})},addtocard:function(e){this.goodsCount++;var a=e.currentTarget.dataset.product;void 0!=this.shoppingCart.find(function(t){return t.id===a.id})?t.showToast({title:"购物车已存在此商品\n请点击左下角购物车查看",icon:"none"}):(a.count=1,this.shoppingCart.push(a))},showmenuX:function(){this.popmenuShowX=!this.popmenuShowX},showShppingcard:function(){this.$refs.popup.show()},change:function(t){var e=t[1],a=t[0];this.shoppingCart[e].count=a},deleteProduct:function(t){this.shoppingCart.splice(t,1),0===this.shoppingCart.length&&this.$refs.popup.close()},settleAccounts:function(){var e=this;0===this.shoppingCart.length?this.$refs.popup.show():(t.showLoading({title:"加载中"}),t.request({url:this.GLOBAL.serverSrc+"pay/create_order/create",method:"POST",data:{user_id:this.user.id,shopping_cart:this.shoppingCart},success:function(e){t.hideLoading(),200===e.data.status?t.navigateTo({url:"./checkstand?order_id="+e.data.order_id+"&real_price="+e.data.real_price}):t.showToast({title:e.data.msg,icon:"none"})},fail:function(a){t.hideLoading(),e.GLOBAL.requestFail(a)}}))}}};e.default=l}).call(this,a("6e42")["default"])},"0827":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"popup-layer",props:{direction:{type:String,default:"top"}},data:function(){return{ifshow:!1,translateValue:-100,timer:null,iftoggle:!1}},computed:{_translate:function(){var t={top:"transform:translateY(".concat(-this.translateValue,"%)"),bottom:"transform:translateY(".concat(this.translateValue,"%)"),left:"transform:translateX(".concat(-this.translateValue,"%)"),right:"transform:translateX(".concat(this.translateValue,"%)")};return t[this.direction]},_location:function(){var t={top:"bottom:0px;width:100%;",bottom:"top:0px;width:100%;",left:"right:0px;height:100%;",right:"left:0px;height:100%;"};return t[this.direction]+this._translate}},methods:{show:function(){var t=this;this.ifshow=!0;setTimeout(function(){t.translateValue=0,null},100),setTimeout(function(){t.iftoggle=!0,null},300)},close:function(){var t=this;null===this.timer&&this.iftoggle&&(this.translateValue=-100,this.timer=setTimeout(function(){t.ifshow=!1,t.timer=null,t.iftoggle=!1},300))},stopEvent:function(t){}}};e.default=i},"08e8":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{directives:[{name:"show",rawName:"v-show",value:t.ifshow,expression:"ifshow"}],staticClass:"popup-layer",attrs:{eventid:"edfa5e5a-1"},on:{tap:t.close}},[a("view",{ref:"popRef",staticClass:"popup-content",style:t._location,attrs:{eventid:"edfa5e5a-0"},on:{tap:function(e){e.stopPropagation(),t.stopEvent(e)}}},[t._t("default",null,{mpcomid:"edfa5e5a-0"})],2)])},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"26ba":function(t,e,a){"use strict";var i=a("6a08"),n=a.n(i);n.a},"2c32":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticStyle:{height:"100%"}},[a("graceSpeaker",{attrs:{icon:"../../../static/market/trumpet.png",msgs:t.notices,mpcomid:"45d0754b-0"}}),a("view",{staticClass:"grace-cate",staticStyle:{width:"100%",height:"calc(100% - 90px)"}},[a("scroll-view",{staticClass:"grace-cate-left",attrs:{"scroll-y":"","scroll-into-view":t.leftTo}},t._l(t.mainCate,function(e,i){return a("view",{key:i,class:["item",t.currentCateIndex==e.cateid?"current":""],attrs:{"data-cateid":e.cateid,id:"cate"+e.cateid,eventid:"45d0754b-0-"+i},on:{tap:t.changCate}},[t._v(t._s(e.title))])})),a("scroll-view",{staticClass:"grace-cate-right",attrs:{"scroll-y":"","scroll-into-view":t.productListTo,eventid:"45d0754b-3"},on:{scroll:t.rscroll}},t._l(t.mainCate,function(e,i){return a("block",{key:i},[a("view",{staticClass:"grace-title grace-nowrap grace-space-between",staticStyle:{"margin-top":"15px"},attrs:{id:"productList"+e.cateid}},[a("view",{staticClass:"grace-h5 grace-blod"},[t._v(t._s(e.title))])]),a("view",{staticClass:"grace-news-list"},t._l(t.allProducts["cateproducts"+e.cateid],function(e,n){return a("view",{key:n,staticClass:"grace-news-list-items"},[a("image",{staticClass:"grace-news-list-img grace-list-imgs-l",attrs:{src:e.img,mode:"scaleToFill",eventid:"45d0754b-1-"+i+"-"+n},on:{click:function(a){t.showImg(e.img)}}}),a("view",{staticClass:"grace-news-list-title"},[a("view",{staticClass:"grace-news-list-title-main"},[t._v(t._s(e.title))]),a("view",{staticClass:"price"},[t._v("￥"+t._s(e.price))]),a("view",[a("view",{staticClass:"grace-add-to-card",attrs:{"data-product":e,eventid:"45d0754b-2-"+i+"-"+n},on:{tap:t.addtocard}},[t._v("+")])])])])}))])}))],1),a("view",{staticClass:"grace-footer"},[a("view",{staticStyle:{width:"60%"}},[a("view",{staticClass:"icons iconfont icon-gouwuche",attrs:{eventid:"45d0754b-4"},on:{click:t.showShppingcard}},[t.shoppingCart.length>0?a("text",{staticClass:"grace-badge grace-badge-red"},[t._v(t._s(t.shoppingCart.length))]):t._e()]),a("view",{staticClass:"icons iconfont icon-lianxikefu"}),a("view",{staticClass:"icons iconfont icon-jiahao"})]),a("view",{staticStyle:{width:"40%"}},[a("button",{attrs:{type:"warn",eventid:"45d0754b-5"},on:{click:t.settleAccounts}},[t._v("立即结算")])],1)]),a("popup-layer",{ref:"popup",attrs:{direction:t.direction,mpcomid:"45d0754b-2"}},[0===t.shoppingCart.length?a("view",{staticStyle:{"text-align":"center",color:"grey","line-height":"80px"}},[t._v("购物车内空空如也(＞﹏＜)")]):a("view",{staticClass:"grace-form"},[a("view",{staticStyle:{padding:"0 8rpx"}},t._l(t.shoppingCart,function(e,i){return a("view",{key:i,staticClass:"grace-items"},[a("view",{staticClass:"iconss"},[a("image",{staticStyle:{width:"50rpx",height:"50rpx"},attrs:{src:e.img,mode:"widthFix"}})]),a("view",{staticClass:"grace-label"},[t._v(t._s(e.title))]),a("graceNumberBox",{attrs:{minNum:"1",value:e.count,index:i,eventid:"45d0754b-6-"+i,mpcomid:"45d0754b-1-"+i},on:{change:t.change}}),a("view",{staticClass:"delete",attrs:{eventid:"45d0754b-7-"+i},on:{click:function(e){t.deleteProduct(i)}}},[t._v("删除")])],1)}))])])],1)},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},3692:function(t,e,a){"use strict";a.r(e);var i=a("0556"),n=a.n(i);for(var r in i)"default"!==r&&function(t){a.d(e,t,function(){return i[t]})}(r);e["default"]=n.a},"54f8":function(t,e,a){},"630b":function(t,e,a){"use strict";a("7f79");var i=r(a("b0ce")),n=r(a("c5ee"));function r(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(n.default))},"6a08":function(t,e,a){},"72f7":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"graceNumberBox",props:{disabled:{type:Boolean,default:!1},value:{type:Number,default:0},index:{type:Number,default:0},maxNum:{type:Number,default:20},minNum:{type:Number,default:1}},data:function(){return{inputNumber:this.value}},watch:{value:function(t){this.inputNumber=t},inputNumber:function(t){t=Number(t),t>this.maxNum&&(t=this.maxNum,this.inputNumber=t),t<this.minNum&&(t=this.minNum,this.inputNumber=t),this.$emit("change",[t,this.index])}},methods:{add:function(){var t=this.inputNumber+1;this.inputNumber=Number(t)},reduce:function(){var t=this.inputNumber-1;this.inputNumber=t},blur:function(t){this.inputNumber=Number(t.detail.value)}}};e.default=i},7544:function(t,e,a){"use strict";a.r(e);var i=a("e4c0"),n=a.n(i);for(var r in i)"default"!==r&&function(t){a.d(e,t,function(){return i[t]})}(r);e["default"]=n.a},"8be2":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"grace-swiper-msg"},[a("view",{staticClass:"grace-swiper-msg-icon"},[a("image",{attrs:{src:t.icon,mode:"widthFix"}})]),a("swiper",{attrs:{vertical:t.vertical,autoplay:"true",circular:"true",interval:t.interval}},t._l(t.msgs,function(e,i){return a("swiper-item",{key:i,attrs:{mpcomid:"00135ce1-0-"+i}},[a("navigator",{attrs:{url:e.url,"open-type":e.opentype}},[t._v(t._s(e.title))])],1)}))],1)},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"9f9e":function(t,e,a){"use strict";a.r(e);var i=a("08e8"),n=a("f9ce");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("26ba");var s=a("2877"),c=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},a2c9:function(t,e,a){"use strict";a.r(e);var i=a("ab66"),n=a("c83d");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("b6e6");var s=a("2877"),c=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},ab66:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"grace-number-box"},[a("view",{staticClass:"doBtn",attrs:{eventid:"1356c624-0"},on:{tap:t.reduce}},[t._v("-")]),a("input",{attrs:{type:"number",value:t.inputNumber,disabled:t.disabled,eventid:"1356c624-1"},on:{blur:t.blur}}),a("view",{staticClass:"doBtn",attrs:{eventid:"1356c624-2"},on:{tap:t.add}},[t._v("+")])])},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},ac15:function(t,e,a){"use strict";var i=a("ca29"),n=a.n(i);n.a},b6e6:function(t,e,a){"use strict";var i=a("c228"),n=a.n(i);n.a},c228:function(t,e,a){},c5ee:function(t,e,a){"use strict";a.r(e);var i=a("2c32"),n=a("3692");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("ac15");var s=a("2877"),c=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},c83d:function(t,e,a){"use strict";a.r(e);var i=a("72f7"),n=a.n(i);for(var r in i)"default"!==r&&function(t){a.d(e,t,function(){return i[t]})}(r);e["default"]=n.a},ca29:function(t,e,a){},d946:function(t,e,a){"use strict";a.r(e);var i=a("8be2"),n=a("7544");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("db4c");var s=a("2877"),c=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},db4c:function(t,e,a){"use strict";var i=a("54f8"),n=a.n(i);n.a},e4c0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"graceSpeaker",props:{msgs:{type:Array,default:function(){return[]}},icon:{type:String,default:""},interval:{type:Number,default:3e3},vertical:{type:Boolean,default:!0}}};e.default=i},f9ce:function(t,e,a){"use strict";a.r(e);var i=a("0827"),n=a.n(i);for(var r in i)"default"!==r&&function(t){a.d(e,t,function(){return i[t]})}(r);e["default"]=n.a}},[["630b","common/runtime","common/vendor"]]]);